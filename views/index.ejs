<!DOCTYPE html>
<html lang="<%= lang %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–§–∏—à–∏–Ω–≥–∫–µ “õ–∞—Ä—Å—ã —Ç–µ–∫—Å–µ—Ä—É</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-light">

<div class="d-flex">

  <!-- Sidebar (—à–∞–±–ª–æ–Ω —ñ—à—ñ–Ω–µ “õ–æ—Å—ã–ª“ì–∞–Ω) -->
  <%- include('partials/sidebar') %>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="p-5 w-100">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="mb-0"><%= lang === 'kk' ? '–§–∏—à–∏–Ω–≥–∫–µ “õ–∞—Ä—Å—ã —Ç–µ–∫—Å–µ—Ä—É' : '–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–∏—à–∏–Ω–≥' %></h3>
      <div class="d-flex gap-2">
        <button data-lang="kk" class="btn btn-outline-secondary btn-sm<%= lang==='kk'?' active':'' %>">üá∞üáø “ö–∞–∑–∞“õ—à–∞</button>
        <button data-lang="ru" class="btn btn-outline-secondary btn-sm<%= lang==='ru'?' active':'' %>">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button id="theme-toggle" class="btn btn-outline-dark btn-sm">üåó</button>
      </div>
    </div>

    <!-- Form -->
    <form action="/analyze" method="POST" enctype="multipart/form-data" class="d-flex align-items-center gap-3 bg-white shadow-sm rounded p-4 mb-4">
      <div class="input-group">
        <label class="input-group-text bg-primary text-white"><i class="bi bi-upload"></i></label>
        <input type="file" name="file" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary px-4">
        <%= lang === 'kk' ? '–¢–µ–∫—Å–µ—Ä—É' : '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å' %>
      </button>
    </form>

    <% if (result) { %>
      <!-- Risk -->
      <div class="alert 
        <%= result.riskLevel==='High'?'alert-danger':
             result.riskLevel==='Medium'?'alert-warning':'alert-success' %>">
        <strong>
          <%= lang === 'kk'
            ? `“ö–∞—É—ñ–ø –¥–µ“£–≥–µ–π—ñ: ${result.riskLevel==='High'?'–ñ–æ“ì–∞—Ä—ã':result.riskLevel==='Medium'?'–û—Ä—Ç–∞—à–∞':'–¢”©–º–µ–Ω'}`
            : `–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: ${result.riskLevel}` %>
        </strong>
      </div>

      <!-- Email -->
      <div class="card p-4 mb-4 shadow-sm">
        <h5 class="mb-3">üìß Email</h5>
        <dl class="row">
          <dt class="col-sm-3"><%= lang==='kk' ? '–ö—ñ–º–Ω–µ–Ω' : '–û—Ç –∫–æ–≥–æ' %>:</dt>
          <dd class="col-sm-9"><%= result.from %></dd>

          <dt class="col-sm-3"><%= lang==='kk' ? '–¢–∞“õ—ã—Ä—ã–ø' : '–¢–µ–º–∞' %>:</dt>
          <dd class="col-sm-9"><%= result.subject %></dd>

          <dt class="col-sm-3"><%= lang==='kk' ? '–°—ñ–ª—Ç–µ–º–µ–ª–µ—Ä' : '–°—Å—ã–ª–∫–∏' %>:</dt>
          <dd class="col-sm-9">
            <ul class="mb-0">
              <% result.urls.forEach(u => { %>
                <li><a href="<%= u %>" target="_blank"><%= u %></a></li>
              <% }) %>
            </ul>
          </dd>
        </dl>
      </div>

      <!-- Domain -->
      <div class="card p-4 mb-4 shadow-sm">
        <h5 class="mb-3">üåê Domain & DNS</h5>
        <dl class="row">
          <dt class="col-sm-3">–î–æ–º–µ–Ω:</dt>
          <dd class="col-sm-9"><%= result.domain %></dd>

          <dt class="col-sm-3">SPF:</dt>
          <dd class="col-sm-9"><%= result.spf %></dd>

          <dt class="col-sm-3">DKIM:</dt>
          <dd class="col-sm-9"><%= result.dkim %></dd>

          <dt class="col-sm-3">DMARC:</dt>
          <dd class="col-sm-9"><%= result.dmarc %></dd>
        </dl>
      </div>

      <!-- VirusTotal -->
      <div class="card p-4 mb-4 shadow-sm">
        <h5 class="mb-3">üõ° VirusTotal</h5>
        <% result.vtResults.forEach(vt => { %>
          <p><a href="<%= vt.url %>" target="_blank"><%= vt.url %></a></p>
          <ul>
            <li>malicious: <%= vt.stats.malicious %></li>
            <li>suspicious: <%= vt.stats.suspicious %></li>
            <li>undetected: <%= vt.stats.undetected %></li>
            <li>harmless: <%= vt.stats.harmless %></li>
            <li>timeout: <%= vt.stats.timeout %></li>
          </ul>
          <hr>
        <% }) %>
      </div>

      <!-- Download PDF -->
      <a href="/download?<%= 
        'from='+encodeURIComponent(result.from)+
        '&subject='+encodeURIComponent(result.subject)+
        '&domain='+encodeURIComponent(result.domain)+
        '&spf='+encodeURIComponent(result.spf)+
        '&dkim='+encodeURIComponent(result.dkim)+
        '&dmarc='+encodeURIComponent(result.dmarc)+
        '&risk='+encodeURIComponent(result.riskLevel)+
        '&urls='+encodeURIComponent(result.urls.join(',')) 
      %>" class="btn btn-outline-primary">
        üìÑ <%= lang==='kk'? 'PDF –∂“Ø–∫—Ç–µ—É':'–°–∫–∞—á–∞—Ç—å PDF' %>
      </a>
    <% } %>
  </main>
</div>

<script src="/js/app.js"></script>
</body>
</html>

